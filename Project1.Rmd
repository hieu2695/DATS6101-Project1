---
title: "Project 1 - DATS 6101"
author: "GROUP NAME"
date: "9/29/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r define_loadPkg, echo=F}
loadPkg = function(x) { if (!require(x,character.only=T, quietly =F)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T, quietly=T)) stop("Package not found") } }
```

```{r dataset, echo = T}

# read dataset
movies <- read.csv("movies.csv")

unique(movies$rating) # check rating types
unique(movies$genre) # check genre types

# filter for movies with MPAA film rating system and most popular genre 
movies_new <- subset(movies, movies$rating%in%c("G","NC-17","PG-13","R","PG"))
# movies$genre%in%c("Action","Adventure","Animation","Biography","Comedy","Crime","Drama","Horror"))
# apply factor again for new dataset
movies_new$rating <- factor(movies_new$rating) 
movies_new$genre <- factor(movies_new$genre)
str(movies_new)


```

#### SMART Question: Does the genre has any effects on the classification of audiences
* G – General Audiences: All ages admitted. Nothing that would offend parents for viewing by children.
* PG – Parental Guidance Suggested: Some material may not be suitable for children. Parents urged to give "parental guidance". May contain some material parents might not like for their young children.
* PG-13 – Parents Strongly Cautioned: Some material may be inappropriate for children under 13. Parents are urged to be cautious. Some material may be inappropriate for pre-teenagers.
* R – Restricted: Under 17 requires accompanying parent or adult guardian. Contains some adult material. Parents are urged to learn more about the film before taking their young children with them.
* NC-17 – Adults Only: No One 17 and Under Admitted. Clearly adult. Children are not admitted.


``` {r Q1, echo = T}
# create contigency table
contable = table(movies_new$rating, movies_new$genre)
contable

# chi-square test
chitest <- chisq.test(contable)
chitest
chitest$statistic
chitest$parameter
chitest$expected
chitest$p.value

```

* Null Hypothesis: The movie genre and its rating are independent.
* The p-value in the chi-squared test is `r chitest$p.value`, is much smaller than significance level (0.05). Therefore, we reject the null.
* Conclusion: The movie genre and rating are NOT independent.

```{r Q2, echo = T}
loadPkg("ggplot2")

veryhigh_votes <- subset(movies_new, votes > 1e+6 | votes == 1e+6)
high_votes <- subset(movies_new, votes < 1e+6 & votes > 500000 | votes == 500000)
medium_votes <- subset(movies_new, votes < 500000 & votes > 200000 | votes == 200000)
low_votes <- subset(movies_new, votes < 200000)
votes <- rbind(veryhigh_votes, high_votes, medium_votes, low_votes)
#outliers <- boxplot(movies_new$votes)


ggplot() +
  ggtitle("Score distribution with different groups of votes") +
  geom_boxplot(data=veryhigh_votes, aes(x=1,y=score,fill="1")) +
  geom_boxplot(data=high_votes, aes(x=2,y=score,fill="2")) +
  geom_boxplot(data=medium_votes, aes(x=3,y=score,fill="3")) +
  geom_boxplot(data=low_votes, aes(x=4,y=score,fill="4")) +
  theme(plot.title = element_text(hjust=0.5),axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank()) +
  guides(fill=guide_legend(title = "Vote categories")) +
  scale_fill_manual(labels=c("Very High","High","Medium","Low"),values = c("blue","red","green","yellow"))
  
ggplot() +
  ggtitle("Votes distribution over score") +
  geom_point(data=movies_new,mapping=aes(x=score,y=votes,col=genre)) +
  theme(plot.title = element_text(hjust=0.5))

#qqnorm(movies_new$votes)
#qqnorm(movies_new$score)

```

* As shown in boxplots, the movies with highest votes (above 1 million votes) tend to have high scores and the movies with low scores (below 5) tend to get bad votes. However, high score movies do not certainly have high votes and low votes movies do not mean that they have low score. 
* The mapping plot also gives us the same observation, every movies with votes over 1 million always possesses a high score. And at around 500000 votes and below, the score varies extensively. Movies with scores below 5.0 have low votes.
* This illustrates that people often highly grade their favorite movies (with high votes). Meanwhile, they do not recommend bad movies (low score). The reason for the large variety of scores at medium votes ( below 500000) may be due to the genre of the movies that affect the number of audiences. Many genres have good quality of movies but they are not of interest to audiences such as Biography, War, Scifi, Drama, which makes them get low votes even they are highly graded.