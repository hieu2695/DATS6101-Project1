---
title: "Project 1 - DATS 6101"
author: "GROUP NAME"
date: "9/29/2019"
output:
   html_document: 
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r define_loadPkg, echo=F}
loadPkg = function(x) { if (!require(x,character.only=T, quietly =F)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T, quietly=T)) stop("Package not found") } }
```

### Data cleaning

```{r dataset, echo = T}

# read dataset
movies <- read.csv("movies.csv")

# assign NA to movies with budget = 0 
movies$budget <- replace(movies$budget,movies$budget==0, NA)

unique(movies$rating) # check rating types
unique(movies$genre) # check genre types

# filter for movies with MPAA film rating system and most popular genre 
movies_new <- subset(movies, movies$rating%in%c("G","NC-17","PG-13","R","PG"))
# movies$genre%in%c("Action","Adventure","Animation","Biography","Comedy","Crime","Drama","Horror"))
# apply factor again for new dataset
movies_new$rating <- factor(movies_new$rating) 
movies_new$genre <- factor(movies_new$genre)
str(movies_new)


```

#### SMART Question: Does the genre has any effects on the classification of audiences
* G – General Audiences: All ages admitted. Nothing that would offend parents for viewing by children.
* PG – Parental Guidance Suggested: Some material may not be suitable for children. Parents urged to give "parental guidance". May contain some material parents might not like for their young children.
* PG-13 – Parents Strongly Cautioned: Some material may be inappropriate for children under 13. Parents are urged to be cautious. Some material may be inappropriate for pre-teenagers.
* R – Restricted: Under 17 requires accompanying parent or adult guardian. Contains some adult material. Parents are urged to learn more about the film before taking their young children with them.
* NC-17 – Adults Only: No One 17 and Under Admitted. Clearly adult. Children are not admitted.


``` {r Q1, echo = T}
# create contigency table
contable = table(movies_new$rating, movies_new$genre)
contable

# chi-square test
chitest <- chisq.test(contable)
chitest
chitest$statistic
chitest$parameter
chitest$expected
chitest$p.value

```

* Null Hypothesis: The movie genre and its rating are independent.
* The p-value in the chi-squared test is `r chitest$p.value`, is much smaller than significance level (0.05). Therefore, we reject the null.
* Conclusion: The movie genre and rating are NOT independent.

### SMART Question: Is there any relationships between the votes and the scores and which genre of movies achieve the highest average votes during 30 years?

```{r Q2.1, echo = T}
loadPkg("ggplot2")

veryhigh_votes <- subset(movies_new, votes > 1e+6 | votes == 1e+6)
high_votes <- subset(movies_new, votes < 1e+6 & votes > 500000 | votes == 500000)
medium_votes <- subset(movies_new, votes < 500000 & votes > 250000 | votes == 250000)
low_votes <- subset(movies_new, votes < 200000)
votes <- rbind(veryhigh_votes, high_votes, medium_votes, low_votes)


ggplot() +
  ggtitle("Score distribution with different groups of votes") +
  geom_boxplot(data=veryhigh_votes, aes(x=1,y=score,fill="1")) +
  geom_boxplot(data=high_votes, aes(x=2,y=score,fill="2")) +
  geom_boxplot(data=medium_votes, aes(x=3,y=score,fill="3")) +
  geom_boxplot(data=low_votes, aes(x=4,y=score,fill="4")) +
  theme(plot.title = element_text(hjust=0.5),axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank()) +
  guides(fill=guide_legend(title = "Vote categories")) +
  scale_fill_manual(labels=c("Very High","High","Medium","Low"),values = c("blue","red","green","yellow"))
  
ggplot() +
  ggtitle("Votes distribution over score") +
  geom_point(data=movies_new,mapping=aes(x=score,y=votes,col=genre)) +
  theme(plot.title = element_text(hjust=0.5))

#qqnorm(movies_new$votes)
#qqnorm(movies_new$score)

```

* As shown in boxplots, the movies with highest votes (above 1 million votes) tend to have high scores and the movies with low scores (below 5) tend to get bad votes. However, high score movies do not certainly have high votes and low votes movies do not mean that they have low score. 
* The mapping plot also gives us the same observation, every movies with votes over 1 million always possesses a high score. And at around 500000 votes and below, the score varies extensively. Movies with scores below 5.0 have low votes.
* This illustrates that people often highly grade their favorite movies (with high votes). Meanwhile, they do not recommend bad movies (low score). The reason for the large variety of scores at medium votes ( below 500000) may be due to the genre of the movies that affect the number of audiences. Many genres have good quality of movies but they are not of interest to audiences such as Biography, War, Scifi, Drama, which makes them get low votes even they are highly graded.

* Number of published movies by genre over time

``` {r Q2.2}
ggplot(movies_new, aes(x=genre, fill = genre)) +
  geom_bar(stat="count", ) +
  theme(axis.text.x = element_text(angle=90, hjust=1)) +
  ggtitle("The number of movies published by genre from 1986 to 2016") +
  guides(fill = guide_legend(title="Genre"))

```
 * For better analysis, we will remove genres with extreme low number of movies during the period. We will focus our research on genres with lots of published movies (over 100): Action, Adventure, Animation, Biography, Comedy, Crime, Drama, Horror.






### SMART Question: Which genre gain most profit and which genres gain no profit?

```{r profit}
movies_new$profit <- movies_new$gross - movies_new$budget
movies_new$roi <- (movies_new$profit)*100/(movies_new$budget)
Action <- subset(movies_new, movies_new$genre == "Action")
Adventure <- subset(movies_new, movies_new$genre == "Adventure")
Animation <- subset(movies_new, movies_new$genre == "Animation")
Biography <- subset(movies_new, movies_new$genre == "Biography")
Comedy <- subset(movies_new, movies_new$genre == "Comedy")
Crime <- subset(movies_new, movies_new$genre == "Crime")
Drama <- subset(movies_new, movies_new$genre == "Drama")
Family <- subset(movies_new, movies_new$genre == "Family")
Fantasy <- subset(movies_new, movies_new$genre == "Fantasy")
Horror <- subset(movies_new, movies_new$genre == "Horror")
Musical <- subset(movies_new, movies_new$genre == "Musical")
Mystery <- subset(movies_new, movies_new$genre == "Mystery")
Romance <- subset(movies_new, movies_new$genre == "Romance")
SciFi <- subset(movies_new, movies_new$genre == "Sci-Fi")
War <- subset(movies_new, movies_new$genre == "War")
Western <- subset(movies_new, movies_new$genre == "Western")
Thriller <- subset(movies_new, movies_new$genre == "Thriller")

Action_pf <- mean(Action$profit, na.rm=T)
Adventure_pf <- mean(Adventure$profit, na.rm=T)
Animation_pf <- mean(Animation$profit, na.rm=T)
Biography_pf <- mean(Biography$profit, na.rm=T)
Comedy_pf <- mean(Comedy$profit, na.rm=T)
Crime_pf <- mean(Crime$profit, na.rm=T)
Drama_pf <- mean(Drama$profit, na.rm=T)
Family_pf <- mean(Family$profit, na.rm=T)
Fantasy_pf <- mean(Fantasy$profit, na.rm=T)
Horror_pf <- mean(Horror$profit, na.rm=T)
Musical_pf <- mean(Musical$profit, na.rm=T)
Mystery_pf <- mean(Mystery$profit, na.rm=T)
Romance_pf <- mean(Romance$profit, na.rm=T)
SciFi_pf <- mean(SciFi$profit, na.rm=T)
War_pf <- mean(War$profit, na.rm=T)
Western_pf <- mean(Western$profit, na.rm=T)
Thriller_pf <- mean(Thriller$profit, na.rm=T)

pf <- c(Action_pf, Adventure_pf, Animation_pf, Biography_pf, Comedy_pf, Crime_pf, Drama_pf, Family_pf, Fantasy_pf, Horror_pf, Musical_pf, Mystery_pf, Romance_pf, SciFi_pf, War_pf, Western_pf, Thriller_pf)
DF_pf <- data.frame(profit_average = pf*(1e-6), genre = c("Action","Adventure","Animation","Biography","Comedy","Crime","Drama","Family","Fantasy","Horror","Musical","Mystery","Romance","Sci-Fi","War","Western","Thriller"))

DF_pf <- na.omit(DF_pf)

ggplot(DF_pf, aes(x=genre, y=profit_average, group=1)) +
  geom_line(linetype="dashed", color ="blue") +
  geom_point(color = "red") +
  theme(axis.text.x = element_text(angle=90, hjust=1), plot.title = element_text(h=0.5)) +
  ggtitle("The profit average by different movie genres") +
  ylab("Profit Average (millions USD)")


```

```{r ProfitvsScore}

ggplot() +
  geom_point(data=movies_new, mapping=aes(x=score, y=profit*(1e-6), col=genre), na.rm=T) +
  ggtitle("Profit vs Score") + 
  ylab("Profit (Millions USD")

```

* There is no correlation between profit and movie score except the extreme values. We can realize that high profit movies (more than 500 m$) always get good scores (around 7.5), and low score movies (smaller than 3.0) always receive negative profits.

``` {r ProfitvsVotes}
ggplot() +
  geom_point(data=movies_new, mapping=aes(x=votes, y=profit*(1e-6), col=genre), na.rm=T) +
  ggtitle("Profit vs Votes") + 
  ylab("Profit (Millions USD")


```


``` {r ROI}


Action_roi <- mean(Action$roi, na.rm=T)
Adventure_roi <- mean(Adventure$roi, na.rm=T)
Animation_roi <- mean(Animation$roi, na.rm=T)
Biography_roi <- mean(Biography$roi, na.rm=T)
Comedy_roi <- mean(Comedy$roit, na.rm=T)
Crime_roi <- mean(Crime$roi, na.rm=T)
Drama_roi <- mean(Drama$roi, na.rm=T)
Family_roi <- mean(Family$roi, na.rm=T)
Fantasy_roi <- mean(Fantasy$roi, na.rm=T)
Horror_roi <- mean(Horror$roi, na.rm=T)
Musical_roi <- mean(Musical$roi, na.rm=T)
Mystery_roi <- mean(Mystery$roi, na.rm=T)
Romance_roi <- mean(Romance$roi, na.rm=T)
SciFi_roi <- mean(SciFi$roi, na.rm=T)
War_roi <- mean(War$roi, na.rm=T)
Western_roi <- mean(Western$roi, na.rm=T)
Thriller_roi <- mean(Thriller$roi, na.rm=T)

roi <- c(Action_roi, Adventure_roi, Animation_roi, Biography_roi, Comedy_roi, Crime_roi, Drama_roi, Family_roi, Fantasy_roi, Horror_roi, Musical_roi, Mystery_roi, Romance_roi, SciFi_roi, War_roi, Western_roi, Thriller_roi)
DF_roi <- data.frame(ROI = roi, genre = c("Action","Adventure","Animation","Biography","Comedy","Crime","Drama","Family","Fantasy","Horror","Musical","Mystery","Romance","Sci-Fi","War","Western","Thriller"))

DF_roi <- na.omit(DF_roi)
DF_roi <- subset(DF_roi, ! DF_roi$genre == "Horror") # remove extreme values

ggplot(DF_roi, aes(x=genre, y = ROI, group = 1)) +
  geom_line(linetype="dashed", color ="blue") +
  geom_point(color = "red") +
  theme(axis.text.x = element_text(angle=90, hjust=1), plot.title = element_text(hjust=0.5)) +
  ggtitle("The Return on Investment by different movie genres") +
  ylab("Return on Investment (%)")



```

```{r roi&score}

movies_new_nohr <- subset(movies_new, ! movies_new$genre == "Horror")
ggplot() +
  geom_point(data=movies_new_nohr, mapping=aes(x=score, y=roi, col=genre), na.rm=T) +
  ggtitle("Return on Investment vs Score") + 
  ylab("Return on Investment (%)")


ggplot() +
  geom_point(data=movies_new_nohr, mapping=aes(x=votes, y=roi, col=genre), na.rm=T) +
  ggtitle("Return on Investment vs Votes") + 
  ylab("Return on Investment (%)")



```


```{r AnovaTest}

score_anova <- aov(score ~ genre, movies_new)
summary(score_anova)

votes_anova <- aov(votes ~ genre, movies_new)
summary(votes_anova)

profit_anova <- aov(profit ~ genre, movies_new)
summary(profit_anova)

budget_anova <- aov(budget ~ genre, movies_new)

roi_anova <- aov(roi ~ genre, movies_new)
summary(roi_anova)

gross_anova <- aov(gross ~ genre, movies_new)
summary(gross_anova)



```



```{r gross&budget}
plot(gross ~ budget, movies_new)


```